services:
  comicrack:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: comicrack-web
    image: comicrack-web
    ports:
      - "5700:3000"   # Selkies HTTP
      - "5701:3001"   # Selkies HTTPS
    environment:
      # Mode Wayland — Selkies/pixelflux fournit le socket, labwc est le compositor.
      # Wine tourne via XWayland sur labwc.
      - PIXELFLUX_WAYLAND=true
      - SELKIES_MANUAL_WIDTH=1280
      - SELKIES_MANUAL_HEIGHT=800
      - WINE_DPI=120
      - CURSOR_SIZE=24
      - XCURSOR_THEME=whiteglass
      - WINE_FONT=Arial
      - COMIC_DARK=1
      - WINETRICKS_PACKAGES=dotnet48 corefonts
      # Standard LSIO permissions.
      - PUID=1000
      - PGID=1000
    volumes:
      # Préfixe Wine persistant — évite de re-run winetricks à chaque redémarrage
      - comicrack-config:/config
    restart: unless-stopped

volumes:
  comicrack-config:
